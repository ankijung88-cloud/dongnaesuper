<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë™ë„¤ìŠˆí¼ - ì£¼ë¬¸/ê²°ì œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <!-- PortOne SDK (Optional for real payment later) -->
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
</head>

<body>
    <header>
        <a href="index.html" class="logo">ğŸ¥¬ ë™ë„¤ìŠˆí¼</a>
    </header>

    <div class="container">
        <h2>ğŸ’³ ì£¼ë¬¸/ê²°ì œ</h2>

        <div class="card">
            <h3>ì£¼ë¬¸ ì •ë³´</h3>
            <p>ë°›ëŠ” ë¶„: <input type="text" id="buyer-name" placeholder="ì´ë¦„ ì…ë ¥" style="padding:5px;"></p>
            <p style="margin-top:5px;">ë°°ë‹¬ ì¥ì†Œ: <span id="mart-place"></span></p>
            <hr>
            <h3>ê²°ì œ ê¸ˆì•¡: <span id="total-price" style="color: var(--secondary);">0ì›</span></h3>
        </div>

        <button onclick="processPayment()" class="btn btn-primary" style="font-size: 1.2rem; padding: 15px;">
            ê²°ì œí•˜ê¸°
        </button>
    </div>

    <script src="js/data.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
    <script>
        let totalAmount = 0;
        let cartItems = [];

        document.addEventListener('DOMContentLoaded', () => {
            const mart = Storage.getMart();
            if (mart) document.getElementById('mart-place').innerText = mart.region + " (ë§ˆì„íšŒê´€)";

            const cart = Storage.getCart();
            totalAmount = 0;

            for (const [pid, qty] of Object.entries(cart)) {
                const product = DATA.products.find(p => p.id == pid);
                if (product) {
                    totalAmount += product.price * qty;
                    cartItems.push({ name: product.name, qty: qty, price: product.price });
                }
            }
            document.getElementById('total-price').innerText = App.formatCurrency(totalAmount);
        });

        function processPayment() {
            const name = document.getElementById('buyer-name').value;
            if (!name) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            // PortOne could be used here, but for Static PWA without backend verification, 
            // we will simulate success to ensure user can "complete" the flow.
            // In a real static commerce app, we'd use a payment link or client-side only verify (less secure).

            const confirmPay = confirm(App.formatCurrency(totalAmount) + "ì„ ê²°ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ì‹¤ì œ ì²­êµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)");

            if (confirmPay) {
                // Create Order Record
                const order = {
                    id: 'ORD-' + new Date().getTime(),
                    mart: Storage.getMart().name,
                    items: cartItems,
                    total: totalAmount,
                    date: new Date().toLocaleString(),
                    status: 'ê²°ì œì™„ë£Œ'
                };

                Storage.addOrder(order);
                Storage.setCart({}); // Clear Cart

                alert('ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                window.location.href = 'orders.html';
            }
        }
    </script>
</body>

</html>