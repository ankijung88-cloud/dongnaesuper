{% extends 'base.html' %}

{% block content %}
<h2>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h2>

{% if cart_items %}
<div style="margin-top: 20px;">
    {% for item in cart_items %}
    <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <strong>{{ item.product.name }}</strong>
            <div>{{ item.product.price }}ì› x {{ item.quantity }}ê°œ</div>
        </div>
        <div style="text-align: right;">
            <div style="font-weight: bold; color: var(--primary);">{{ item.subtotal }}ì›</div>
            <button onclick="updateQty('{{ item.product.id }}', 0)"
                style="background: #efefef; border: none; padding: 5px 10px; border-radius: 5px; margin-top: 5px;">ì‚­ì œ</button>
        </div>
    </div>
    {% endfor %}

    <div style="text-align: right; font-size: 1.2rem; font-weight: bold; margin: 20px 0;">
        ì´ ê²°ì œê¸ˆì•¡: <span style="color: var(--secondary);">{{ total }}ì›</span>
    </div>

    <a href="{% url 'core:checkout' %}" class="btn btn-primary">ì£¼ë¬¸í•˜ê¸°</a>
</div>
{% else %}
<p style="margin-top: 50px; text-align: center;">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
<a href="{% url 'core:store_home' %}" class="btn btn-secondary">ìƒí’ˆ ë‹´ìœ¼ëŸ¬ ê°€ê¸°</a>
{% endif %}

<script>
    function updateQty(pid, qty) {
        if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        fetch("{% url 'core:cart_action' %}", {
            method: "POST",
            headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken },
            body: JSON.stringify({ product_id: pid, action: 'update', quantity: qty })
        }).then(() => location.reload());
    }
</script>
{% endblock %}